\documentclass[12pt]{scrartcl}


\setlength{\parindent}{0pt}
\setlength{\parskip}{.25cm}

\usepackage{graphicx}

\usepackage{xcolor}

\definecolor{darkred}{rgb}{0.5,0,0}
\definecolor{darkgreen}{rgb}{0,0.5,0}
\usepackage[pdfusetitle]{hyperref}
\hypersetup{
  letterpaper,
  colorlinks,
  linkcolor=red,
  citecolor=darkgreen,
  menucolor=darkred,
  urlcolor=blue,
  pdfpagemode=none,
  pdftitle={Lab 6.0 - Functions II},
  pdfauthor={Christopher M. Bourke}
}

\definecolor{MyDarkBlue}{rgb}{0,0.08,0.45}
\definecolor{MyDarkRed}{rgb}{0.45,0.08,0}
\definecolor{MyDarkGreen}{rgb}{0.08,0.45,0.08}

\definecolor{mintedBackground}{rgb}{0.95,0.95,0.95}
\definecolor{mintedInlineBackground}{rgb}{.90,.90,1}

%\usepackage{newfloat}
\usepackage[newfloat=true]{minted}
\setminted{mathescape,
               linenos,
               autogobble,
               frame=none,
               framesep=2mm,
               framerule=0.4pt,
               %label=foo,
               xleftmargin=2em,
               xrightmargin=0em,
               startinline=true,  %PHP only, allow it to omit the PHP Tags *** with this option, variables using dollar sign in comments are treated as latex math
               numbersep=10pt, %gap between line numbers and start of line
               style=default, %syntax highlighting style, default is "default"
               			    %gallery: http://help.farbox.com/pygments.html
			    	    %list available: pygmentize -L styles
               bgcolor=mintedBackground} %prevents breaking across pages
               
\setmintedinline{bgcolor={mintedBackground}}
\setminted[text]{bgcolor={mintedBackground},linenos=false,autogobble,xleftmargin=1em}
%\setminted[php]{bgcolor=mintedBackgroundPHP} %startinline=True}
\SetupFloatingEnvironment{listing}{name=Code Sample}
\SetupFloatingEnvironment{listing}{listname=List of Code Samples}

\title{CSCE 155 - Java}
\subtitle{Lab 6.0 - Methods, Enumerated Types and Exceptions}
\author{~}
\date{~}

\begin{document}

\maketitle

\section*{Prior to Lab}

Before attending this lab:
\begin{enumerate}
  \item Read and familiarize yourself with this handout.
  \item Read Chapters 5--6 and 29--30 of the \href{http://cse.unl.edu/~cbourke/ComputerScienceOne.pdf}{Computer Science I} textbook
\end{enumerate}

\section*{Peer Programming Pair-Up}

\textbf{For students in the online section:} you may complete
the lab on your own if you wish or you may team up with a partner
of your choosing, or, you may consult with a lab instructor to get
teamed up online (via Zoom).

\textbf{For students in the face-to-face section:} your
lab instructor will team you up with a partner.  

To encourage collaboration and a team environment, labs are
structured in a \emph{peer programming} setup.  At the start of
each lab, you will be randomly paired up with another student 
(conflicts such as absences will be dealt with by the lab instructor).
One of you will be designated the \emph{driver} and the other
the \emph{navigator}.  

The navigator will be responsible for reading the instructions and
telling the driver what to do next.  The driver will be in charge of the
keyboard and workstation.  Both driver and navigator are responsible
for suggesting fixes and solutions together.  Neither the navigator
nor the driver is ``in charge.''  Beyond your immediate pairing, you
are encouraged to help and interact with other pairs in the lab.

Each week you should alternate: if you were a driver last week, 
be a navigator next, etc.  Resolve any issues (you were both drivers
last week) within your pair.  Ask the lab instructor to resolve issues
only when you cannot come to a consensus.  

Because of the peer programming setup of labs, it is absolutely 
essential that you complete any pre-lab activities and familiarize
yourself with the handouts prior to coming to lab.  Failure to do
so will negatively impact your ability to collaborate and work with 
others which may mean that you will not be able to complete the
lab.  

\section{Lab Objectives \& Topics}
At the end of this lab you should be familiar with the following
\begin{itemize}
  \item Basics of enumerated types
  \item How to use exceptions for error handling
  \item Have exposure to a formal unit testing framework 
\end{itemize}

\section{Background}

\subsection*{Enumerated Types}

Enumerated types are data types that define a set of named values.  
Enumerated types are often ordered and internally associated with 
integers (starting with 0 by default and incremented by one in the 
order of the list).  The purpose of enumerated types is to organize 
certain types and enforce specific values.  Without enumerated types, 
integer values would be used, called ``magic numbers.''  This would 
require constantly looking back to the documentation to find out which
numbers corresponded to which value.  Enumerated types provide 
a human-readable ``tag'' to these types of elements, relieving the 
programmer of continually having to refer to the convention and avoiding 
errors.

In Java, enumerated types are a special type of class in which you
define a list of values. An example:

\begin{minted}{java}
public enum DayOfWeek {
	SUNDAY,
	MONDAY,
	TUESDAY, 
	WEDNESDAY,
	THURSDAY,
	FRIDAY,
	SATURDAY
}
\end{minted}
Elsewhere in the code, you can use the enumerated type as follows.
\begin{minted}{java}
//create a variable:
DayOfWeek today = DayOfWeek.MONDAY;

//make a comparison:
if(today == SATURDAY) {
  ...
}
\end{minted}

\subsection*{Exceptions \& Error Handling}

Errors in the execution of a program are unavoidable: users may enter 
invalid input, or the expected resources (files or database connections) 
may be unavailable, etc.  In Java, errors are communicated and handled through 
the use of \emph{exceptions}.  When an error condition occurs or is detected, 
a program can \mintinline{java}{throw} an exception with a 
human-readable error message.  

Exceptions can give errors \emph{semantic} meaning.  For example, 
a \mintinline{java}{NullPointerException} and an 
\mintinline{java}{IllegalArgumentException} are two distinct 
\emph{types} of exceptions that can be distinguished (and thus
treated differently) by the language itself.  
When the program executes a piece of code 
that could potentially result in an exception, it can be handled by using 
a \mintinline{java}{try-catch} block: we \mintinline{java}{try} to
execute the snippet of code and, if an \mintinline{java}{Exception}
occurs (is thrown) then we can \mintinline{java}{catch} it and
handle it.  A block of code may potentially throw multiple different
types of exceptions.  You can write code to handle each exception in a 
different manner or simply echo (print) to the user a different message 
based on the error.  A basic example:

\begin{minted}{java}
Integer a, b;
//read in a, b
try { 
  if(b == 0) {
     throw new IllegalArgumentException("Division by " +
	"zero is not valid.\n");
  } else {
     c = a / b;
  }

  BufferedWriter out = new BufferedWriter(
	new FileWriter("/etc/passwd"));
  out.write("result = "+c);

} catch(IllegalArgumentException e1) {
     System.err.println("Division by zero is undefined!");
     System.exit(1);
} catch(SecurityException e2) {
     System.err.println("You are not root, you " +
	"can't write to the password file! ");
     System.exit(1);
}
\end{minted}


\section{Activities}

Clone the GitHub project for this lab using the following URL:
\url{https://github.com/cbourke/CSCE155-Java-Lab06}

\subsection{(Re)designing Your Functions}

In the previous lab you designed several functions to convert RGB
values to gray-scale (using one of three techniques) and to sepia.
The details of how to do this are available in the previous lab and 
are repeated for your convenience below.  

In this lab you will update these functions to make them a bit
easier to use and to utilize error handling.  For the
gray scale functions, there was a function for each of the three 
techniques.  We can simplify this design and have only one function
that takes another parameter: an enumerated type that identifies
which of the three techniques (average, lightness or luminosity)
are to be used.  In addition, you will add error handling to 
both functions.

\begin{enumerate}
  \item Create an enumerated type named \mintinline{java}{GrayScaleMode}
  and specify the three modes. 
  \item Implement the \mintinline{java}{toGrayScale()} method
  to convert the given \mintinline{java}{RGB} using the technique
  specified by the given \mintinline{java}{mode}
  \item Update both functions to check if the given \mintinline{java}{RGB}'s
  color values are all within the expected range of $[0, 255]$.  If not,
  throw an \mintinline{java}{IllegalArgumentException} with an
  appropriate error message.
\end{enumerate}

\subsection{Running Unit Tests}

As with the previous lab, you can test your functions using 
the full image driver program on the provided images or some
of your own.  However, this is essentially an 
\emph{ad-hoc test} which is not very rigorous nor reliable 
and is a manual process.  

In the last lab you wrote several \emph{informal} unit tests.  
Writing unit tests automates the testing process and is far more
rigorous.  However, this involved writing a lot of boilerplate 
code to run the tests, print out the results and keep track 
of the number passed/failed.  

In practice, it is better to use a formal unit testing framework
or library.  For Java, the standard unit testing tool is JUnit 
(\url{https://junit.org/junit5/}).  We have provided a JUnit
testing suite (see \mintinline{java}{ColorUtilsTests} that
contains a number of unit tests for your functions.  A few
observations about JUnit testing code:
\begin{itemize}
  \item There is no \mintinline{java}{main} method, but you can
  still run the file in Eclipse via the play button.  It will 
  launch JUnit and the framework will run all of the tests, 
  producing a report on how many tests were run and how many
  passed/failed with some details on how they failed.
  \item Methods are designated as ``test'' methods using 
  \emph{annotations} (\mintinline{java}{@Test} for example).
  This tells the JUnit framework that the method performs
  some unit test and makes an \emph{assertion} about the 
  result that can be used to determine if the test failed or
  passed.  Annotations do not affect the code, but instead
  give it aspects or attributes that other code can recognize
  and thus affect.  This is known as \emph{Aspect Oriented Programming}
  (or \emph{Attribute Oriented}).
  \item A typical Eclipse project setup for JUnit involves
  separating the project code and testing code into separate
  source files as this project has been setup: the project 
  files are in \mintinline{text}{src/main/java/} and the
  testing code is in \mintinline{text}{src/test/java/}.  Note
  that these are \emph{not} packages.  Generally, Testing
  code for a class is placed in the \emph{same} package.
\end{itemize}

Run the test suite and verify that your code passes \emph{all} 
the tests.  Fix any issues or bugs that become apparent as a 
result of this testing.  Passing 100\% of the provided test cases
will suffice to complete the lab.  However, we \emph{highly encourage}
you to read the JUnit test file to understand how the tests are setup
and performed and then to add a few of your own tests.  

\section*{Color Formulas}

To convert an RGB value to gray-scale you can use one of several
different techniques.  Each technique ``removes'' the color value by
setting all three RGB values to the same value but each technique 
does so in a slightly different way.

The first technique is to simply take the average of all three values:
  $$\frac{r + g + b}{3}$$

The second technique, known as the ``lightness'' technique averages 
the most prominent and least prominent colors:
  $$\frac{\max\{r, g, b\} + \min\{r, g, b\}}{2}$$

The luminosity technique uses a weighted average to account for a human 
perceptual preference toward green, setting all three values to:
  $$0.21 r + 0.72 g + 0.07 b$$
In all three cases, the integer values should be \emph{rounded} rather 
than truncated.

A sepia filter sets different values to each of the three RGB components 
using the following formulas.  Given a current $(r,g,b)$ value, the sepia
tone RGB value, $(r',g',b')$ would be:
$$\begin{array}{ll}
  r' &= 0.393r + 0.769g + 0.189b \\
  g' &= 0.349r + 0.686g + 0.168b \\
  b' &= 0.272r + 0.534g + 0.131b
\end{array}$$
As with the gray-scale techniques, values should be rounded.  If any of
the resulting RGB values exceeds 255, they should be reset to the 
maximum, 255.

\section{Handin/Grader Instructions}

\begin{enumerate}
  \item Hand in your completed files:
  \begin{itemize}
    \item \mintinline{text}{ColorUtils.java}
    \item \mintinline{text}{GrayScaleMode.java}
    \item \mintinline{text}{ColorUtilsTests.java}
    \item (no worksheet is necessary for this lab)
  \end{itemize}
  through the webhandin (\url{https://cse-apps.unl.edu/handin}) 
  using your cse login and password.  
  \item Even if you worked with a partner, you \emph{both} should
  turn in all files.
  \item Verify your program by grading yourself through the
  webgrader (\url{https://cse.unl.edu/~cse155h/grade/}) using the
  same credentials.
\end{enumerate}

\section{Advanced Activities (Optional)}

\subsection{Custom Exceptions}

In this lab you threw an \mintinline{java}{IllegalArgumentException}
if the \mintinline{java}{RGB} value was invalid.  The exception was
still generic/general.  You can make your own project-specific 
exception types by creating your own class and \emph{extending} a
\mintinline{java}{RuntimeException}.  Read the course textbook for
details and create your own \mintinline{java}{IllegalRgbException}
class.  Modify your project to use it.

\subsection{Ant}

Large projects require even more abstraction and tools to manage source code 
and specify how it gets built.  For Java, a popular build tool is Apache Ant 
(\url{http://ant.apache.org/}).  Ant is a build utility that builds Java projects as 
specified in a special XML file (\mintinline{text}{build.xml}).  The build file specifies 
how pieces get built and the inter-dependencies on components.  Familiarize 
yourself with Ant by reading the following tutorials.
\begin{itemize}
  \item \url{http://ant.apache.org/manual/tutorial-HelloWorldWithAnt.html}
  \item \url{http://www.vogella.com/articles/ApacheAnt/article.html}
\end{itemize}
Provided in project is an example \mintinline{text}{build.xml} file.  Modify it for the 
code base you created in this lab and use it to compile and run the code from 
the command line.  In particular, from the command line:
\begin{enumerate}
  \item Place all source files into a folder named \mintinline{text}{src} in the
	same directory as the \mintinline{text}{build.xml} file (it should be like this already)
  \item Modify the \mintinline{text}{build.xml} file appropriately by specifying 
    what your main executable class is.  To do this, modify the \mintinline{text}{main.class}
    property's value to the fully qualified (full path name) class that you wish to run.
  \item Compile your project by executing the following command:
	\mintinline{text}{ant compile}
  \item Run your project by executing the following command:
	\mintinline{text}{ant run}
\end{enumerate}

\end{document}
